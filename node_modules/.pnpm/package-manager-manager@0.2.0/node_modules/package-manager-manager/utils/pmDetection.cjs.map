{"version":3,"file":"pmDetection.cjs","sources":["../../src/utils/pmDetection.ts"],"sourcesContent":["import type { PackageManagerName } from 'src/packageManager';\nimport { lockFiles } from './locks';\nimport { getProjectRootDir } from './workspace';\n\nexport function detectPackageManagerBasedOnUserAgent(): PackageManagerName | null {\n\tconst npmConfigUserAgent = process.env['npm_config_user_agent'];\n\n\tif (!npmConfigUserAgent) {\n\t\treturn null;\n\t}\n\n\tconst pmInfo = npmConfigUserAgent.split(' ')[0];\n\n\tconst matchedPm = pmInfo?.match(/^(npm|yarn|pnpm|bun)\\//)?.[1] as PackageManagerName | undefined;\n\n\treturn matchedPm ?? null;\n}\n\nexport async function detectPackageManagerBasedOnFiles(): Promise<PackageManagerName | null> {\n\tconst projectRootDir = await getProjectRootDir();\n\n\tif (!projectRootDir) {\n\t\treturn null;\n\t}\n\n\tconst projectRootFiles = projectRootDir.files;\n\n\tfor (const key of Object.keys(lockFiles)) {\n\t\tconst packageManagerName = key as keyof typeof lockFiles;\n\t\tif (projectRootFiles.includes(lockFiles[packageManagerName])) {\n\t\t\treturn packageManagerName;\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport async function detectPackageManagerName(): Promise<{\n\tpackageManagerName: PackageManagerName | null;\n\tuserAgentPackageManager: PackageManagerName | null;\n\tfilesBasedPackageManager: PackageManagerName | null;\n}> {\n\tconst userAgentPackageManager = detectPackageManagerBasedOnUserAgent();\n\tconst filesBasedPackageManager = await detectPackageManagerBasedOnFiles();\n\n\tconst packageManagerName = userAgentPackageManager ?? filesBasedPackageManager;\n\n\treturn {\n\t\tpackageManagerName,\n\t\tuserAgentPackageManager,\n\t\tfilesBasedPackageManager,\n\t};\n}\n"],"names":["detectPackageManagerBasedOnUserAgent","npmConfigUserAgent","pmInfo","_a","detectPackageManagerBasedOnFiles","projectRootDir","getProjectRootDir","projectRootFiles","key","lockFiles","packageManagerName","detectPackageManagerName","userAgentPackageManager","filesBasedPackageManager"],"mappings":"qNAIO,SAASA,GAAkE,OAC3E,MAAAC,EAAqB,QAAQ,IAAI,sBAEvC,GAAI,CAACA,EACG,OAAA,KAGR,MAAMC,EAASD,EAAmB,MAAM,GAAG,EAAE,CAAC,EAI9C,QAFkBE,EAAAD,GAAA,YAAAA,EAAQ,MAAM,4BAAd,YAAAC,EAA0C,KAExC,IACrB,CAEA,eAAsBC,GAAuE,CACtF,MAAAC,EAAiB,MAAMC,EAAAA,oBAE7B,GAAI,CAACD,EACG,OAAA,KAGR,MAAME,EAAmBF,EAAe,MAExC,UAAWG,KAAO,OAAO,KAAKC,EAAS,SAAA,EAAG,CACzC,MAAMC,EAAqBF,EAC3B,GAAID,EAAiB,SAASE,YAAUC,CAAkB,CAAC,EACnD,OAAAA,EAIF,OAAA,IACR,CAEA,eAAsBC,GAInB,CACF,MAAMC,EAA0BZ,IAC1Ba,EAA2B,MAAMT,IAIhC,MAAA,CACN,mBAH0BQ,GAA2BC,EAIrD,wBAAAD,EACA,yBAAAC,CAAA,CAEF"}