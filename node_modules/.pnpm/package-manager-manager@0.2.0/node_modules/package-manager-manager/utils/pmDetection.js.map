{"version":3,"file":"pmDetection.js","sources":["../../src/utils/pmDetection.ts"],"sourcesContent":["import type { PackageManagerName } from 'src/packageManager';\nimport { lockFiles } from './locks';\nimport { getProjectRootDir } from './workspace';\n\nexport function detectPackageManagerBasedOnUserAgent(): PackageManagerName | null {\n\tconst npmConfigUserAgent = process.env['npm_config_user_agent'];\n\n\tif (!npmConfigUserAgent) {\n\t\treturn null;\n\t}\n\n\tconst pmInfo = npmConfigUserAgent.split(' ')[0];\n\n\tconst matchedPm = pmInfo?.match(/^(npm|yarn|pnpm|bun)\\//)?.[1] as PackageManagerName | undefined;\n\n\treturn matchedPm ?? null;\n}\n\nexport async function detectPackageManagerBasedOnFiles(): Promise<PackageManagerName | null> {\n\tconst projectRootDir = await getProjectRootDir();\n\n\tif (!projectRootDir) {\n\t\treturn null;\n\t}\n\n\tconst projectRootFiles = projectRootDir.files;\n\n\tfor (const key of Object.keys(lockFiles)) {\n\t\tconst packageManagerName = key as keyof typeof lockFiles;\n\t\tif (projectRootFiles.includes(lockFiles[packageManagerName])) {\n\t\t\treturn packageManagerName;\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport async function detectPackageManagerName(): Promise<{\n\tpackageManagerName: PackageManagerName | null;\n\tuserAgentPackageManager: PackageManagerName | null;\n\tfilesBasedPackageManager: PackageManagerName | null;\n}> {\n\tconst userAgentPackageManager = detectPackageManagerBasedOnUserAgent();\n\tconst filesBasedPackageManager = await detectPackageManagerBasedOnFiles();\n\n\tconst packageManagerName = userAgentPackageManager ?? filesBasedPackageManager;\n\n\treturn {\n\t\tpackageManagerName,\n\t\tuserAgentPackageManager,\n\t\tfilesBasedPackageManager,\n\t};\n}\n"],"names":["detectPackageManagerBasedOnUserAgent","npmConfigUserAgent","pmInfo","_a","detectPackageManagerBasedOnFiles","projectRootDir","getProjectRootDir","projectRootFiles","key","lockFiles","packageManagerName","detectPackageManagerName","userAgentPackageManager","filesBasedPackageManager"],"mappings":";;;;;AAIO,SAASA,IAAkE;;AAC3E,QAAAC,IAAqB,QAAQ,IAAI;AAEvC,MAAI,CAACA;AACG,WAAA;AAGR,QAAMC,IAASD,EAAmB,MAAM,GAAG,EAAE,CAAC;AAI9C,WAFkBE,IAAAD,KAAA,gBAAAA,EAAQ,MAAM,8BAAd,gBAAAC,EAA0C,OAExC;AACrB;AAEA,eAAsBC,IAAuE;AACtF,QAAAC,IAAiB,MAAMC;AAE7B,MAAI,CAACD;AACG,WAAA;AAGR,QAAME,IAAmBF,EAAe;AAExC,aAAWG,KAAO,OAAO,KAAKC,CAAS,GAAG;AACzC,UAAMC,IAAqBF;AAC3B,QAAID,EAAiB,SAASE,EAAUC,CAAkB,CAAC;AACnD,aAAAA;AAAA;AAIF,SAAA;AACR;AAEA,eAAsBC,IAInB;AACF,QAAMC,IAA0BZ,KAC1Ba,IAA2B,MAAMT;AAIhC,SAAA;AAAA,IACN,oBAH0BQ,KAA2BC;AAAA,IAIrD,yBAAAD;AAAA,IACA,0BAAAC;AAAA,EAAA;AAEF;"}