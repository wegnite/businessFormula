"use strict";var u=require("@openpanel/sdk"),d=require("@openpanel/sdk");function h(i){return i.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace("-","").replace("_",""))}var p=class extends u.OpenPanel{constructor(t){super({sdk:"web",sdkVersion:"1.0.1",...t});this.options=t;this.lastPath="";this.isServer()||(this.setGlobalProperties({__referrer:document.referrer}),this.options.trackScreenViews&&this.trackScreenViews(),this.options.trackOutgoingLinks&&this.trackOutgoingLinks(),this.options.trackAttributes&&this.trackAttributes())}debounce(t,e){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(t,e)}isServer(){return typeof document>"u"}trackOutgoingLinks(){this.isServer()||document.addEventListener("click",t=>{let e=t.target,n=e.closest("a");if(n&&e){let r=n.getAttribute("href");r?.startsWith("http")&&super.track("link_out",{href:r,text:n.innerText||n.getAttribute("title")||e.getAttribute("alt")||e.getAttribute("title")})}})}trackScreenViews(){if(this.isServer())return;this.screenView();let t=history.pushState;history.pushState=function(...s){let a=t.apply(this,s);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),a};let e=history.replaceState;history.replaceState=function(...s){let a=e.apply(this,s);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),a},window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))});let n=()=>this.debounce(()=>this.screenView(),50);this.options.trackHashChanges?window.addEventListener("hashchange",n):window.addEventListener("locationchange",n)}trackAttributes(){this.isServer()||document.addEventListener("click",t=>{let e=t.target,n=e.closest("button"),r=e.closest("a"),s=n?.getAttribute("data-track")?n:r?.getAttribute("data-track")?r:null;if(s){let a={};for(let c of s.attributes)c.name.startsWith("data-")&&c.name!=="data-track"&&(a[h(c.name.replace(/^data-/,""))]=c.value);let l=s.getAttribute("data-track");l&&super.track(l,a)}})}screenView(t,e){if(this.isServer())return;let n,r;typeof t=="string"?(n=t,r=e):(n=window.location.href,r=t),this.lastPath!==n&&(this.lastPath=n,super.track("screen_view",{...r??{},__path:n,__title:document.title}))}};(i=>{if(i.op&&"q"in i.op){let o=i.op.q||[],t=new p(o.shift()[1]);o.forEach(e=>{e[0]in t&&t[e[0]](...e.slice(1))}),i.op=(e,...n)=>{let r=t[e]?t[e].bind(t):void 0;typeof r=="function"?r(...n):console.warn(`OpenPanel: ${e} is not a function`)},i.openpanel=t}})(window);
