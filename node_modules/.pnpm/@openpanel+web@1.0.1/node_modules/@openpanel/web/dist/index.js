import{OpenPanel as u}from"@openpanel/sdk";import{OpenPanel as w}from"@openpanel/sdk";function h(o){return o.replace(/([-_][a-z])/gi,c=>c.toUpperCase().replace("-","").replace("_",""))}var l=class extends u{constructor(t){super({sdk:"web",sdkVersion:"1.0.1",...t});this.options=t;this.lastPath="";this.isServer()||(this.setGlobalProperties({__referrer:document.referrer}),this.options.trackScreenViews&&this.trackScreenViews(),this.options.trackOutgoingLinks&&this.trackOutgoingLinks(),this.options.trackAttributes&&this.trackAttributes())}debounce(t,r){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(t,r)}isServer(){return typeof document>"u"}trackOutgoingLinks(){this.isServer()||document.addEventListener("click",t=>{let r=t.target,e=r.closest("a");if(e&&r){let n=e.getAttribute("href");n?.startsWith("http")&&super.track("link_out",{href:n,text:e.innerText||e.getAttribute("title")||r.getAttribute("alt")||r.getAttribute("title")})}})}trackScreenViews(){if(this.isServer())return;this.screenView();let t=history.pushState;history.pushState=function(...i){let s=t.apply(this,i);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),s};let r=history.replaceState;history.replaceState=function(...i){let s=r.apply(this,i);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),s},window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))});let e=()=>this.debounce(()=>this.screenView(),50);this.options.trackHashChanges?window.addEventListener("hashchange",e):window.addEventListener("locationchange",e)}trackAttributes(){this.isServer()||document.addEventListener("click",t=>{let r=t.target,e=r.closest("button"),n=r.closest("a"),i=e?.getAttribute("data-track")?e:n?.getAttribute("data-track")?n:null;if(i){let s={};for(let a of i.attributes)a.name.startsWith("data-")&&a.name!=="data-track"&&(s[h(a.name.replace(/^data-/,""))]=a.value);let p=i.getAttribute("data-track");p&&super.track(p,s)}})}screenView(t,r){if(this.isServer())return;let e,n;typeof t=="string"?(e=t,n=r):(e=window.location.href,n=t),this.lastPath!==e&&(this.lastPath=e,super.track("screen_view",{...n??{},__path:e,__title:document.title}))}};export{l as OpenPanel,w as OpenPanelBase};
