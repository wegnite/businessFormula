"use strict";var p=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var g=(s,n)=>{for(var t in n)p(s,t,{get:n[t],enumerable:!0})},v=(s,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of f(n))!w.call(s,e)&&e!==t&&p(s,e,{get:()=>n[e],enumerable:!(r=k(n,e))||r.enumerable});return s};var b=s=>v(p({},"__esModule",{value:!0}),s);var E={};g(E,{OpenPanel:()=>l,OpenPanelBase:()=>d.OpenPanel});module.exports=b(E);var h=require("@openpanel/sdk"),d=require("@openpanel/sdk");function m(s){return s.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace("-","").replace("_",""))}var l=class extends h.OpenPanel{constructor(t){super({sdk:"web",sdkVersion:"1.0.1",...t});this.options=t;this.lastPath="";this.isServer()||(this.setGlobalProperties({__referrer:document.referrer}),this.options.trackScreenViews&&this.trackScreenViews(),this.options.trackOutgoingLinks&&this.trackOutgoingLinks(),this.options.trackAttributes&&this.trackAttributes())}debounce(t,r){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(t,r)}isServer(){return typeof document>"u"}trackOutgoingLinks(){this.isServer()||document.addEventListener("click",t=>{let r=t.target,e=r.closest("a");if(e&&r){let i=e.getAttribute("href");i?.startsWith("http")&&super.track("link_out",{href:i,text:e.innerText||e.getAttribute("title")||r.getAttribute("alt")||r.getAttribute("title")})}})}trackScreenViews(){if(this.isServer())return;this.screenView();let t=history.pushState;history.pushState=function(...a){let o=t.apply(this,a);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),o};let r=history.replaceState;history.replaceState=function(...a){let o=r.apply(this,a);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),o},window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))});let e=()=>this.debounce(()=>this.screenView(),50);this.options.trackHashChanges?window.addEventListener("hashchange",e):window.addEventListener("locationchange",e)}trackAttributes(){this.isServer()||document.addEventListener("click",t=>{let r=t.target,e=r.closest("button"),i=r.closest("a"),a=e?.getAttribute("data-track")?e:i?.getAttribute("data-track")?i:null;if(a){let o={};for(let c of a.attributes)c.name.startsWith("data-")&&c.name!=="data-track"&&(o[m(c.name.replace(/^data-/,""))]=c.value);let u=a.getAttribute("data-track");u&&super.track(u,o)}})}screenView(t,r){if(this.isServer())return;let e,i;typeof t=="string"?(e=t,i=r):(e=window.location.href,i=t),this.lastPath!==e&&(this.lastPath=e,super.track("screen_view",{...i??{},__path:e,__title:document.title}))}};0&&(module.exports={OpenPanel,OpenPanelBase});
